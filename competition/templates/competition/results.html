{% extends 'base.html' %}

{% block title %}{{ event }} &ndash; Výsledky{% endblock %}


{% block meta %}
<meta http-equiv="refresh" content="30" />
{% endblock %}


{% block navbar %}
{% if request.user.is_staff %}
{{ block.super }}
{% endif %}
{% endblock %}

{% block content %}

<style>
  .header {
    position: fixed;
    width: inherit;
    background-color: white;
    margin-top: -15px;
    padding-top: 15px;
  }

.table-container {
  max-height: 83vh;
  overflow-y: auto;
  margin-top: 13vh;
}

.table-header {
  position: sticky;
  top: 0;
  background-color: white;
}

.table th {
  border-top: 0px;
}

</style>

<div id="header" class="header">
  {% if event.started_at %}
  Do konca zostáva: <span id="countdown" class="countdown"></span>
  {% else %}
  Súťaž ešte nezačala
  {% endif %}
  {% if request.user.is_staff %}
    <div class="row">
      {% if is_public %}
        <form action="{% url 'competition:public-results' event.pk %}" method="POST" class="m-2">
      {% else %}
        <form action="{% url 'competition:results' event.pk %}" method="POST" class="m-2">
      {% endif %}
        {% csrf_token %}
        <input type="hidden" id="freeze" name="freeze" value="True">
        <button type="submit" class="main-button">
          <span aria-hidden="true">
            {% if event.frozen_results %}
              Aktualizuj zmrazené výsledky
            {% else %}
              Zmraz aktuálne výsledky
            {% endif %}
          </span>
        </button>
      </form>
      {% if event.frozen_results %}
          {% if is_public %}
            <form action="{% url 'competition:public-results' event.pk %}" method="POST" class="m-2">
          {% else %}
            <form action="{% url 'competition:results' event.pk %}" method="POST" class="m-2">
          {% endif %}
          {% csrf_token %}
          <input type="hidden" id="freeze2" name="freeze" value="False">
          <button type="submit" class="main-button">
            <span aria-hidden="true">
              Rozmraz aktuálne výsledky
            </span>
          </button>
        </form>
      {% endif %}
    </div>
    {% endif %}
  {% if event.frozen_results %}
    <div>Výsledky sú zmrazené. Skutočné výsledky zobrazíme až po súťaži.</div>
  {% endif %}
</div>

<div class="table-container">
  <table class="table" id="my-table">
    <thead class="table-header">
      <tr>
        <th scope="col">Poradie</th>
        <th scope="col">Názov tímu</th>
        <th scope="col">Škola</th>
        <th scope="col">Účastníci</th>
        <th scope="col">Bonifikácia</th>
        {% for category in categories %}
        <th scope="col">{{ category.name }}</th>
        {% endfor %}
        <th scope="col">Úlohy</th>
        <th scope="col">Spolu</th>
      </tr>
    </thead>
    <tbody>
      {% for team in teams %}
      <tr>
        <th scope="row">{{ team.rank }}</th>
        <td>{{ team.name }}</td>
        <td>{{ team.school }}</td>
        <td>{{ team.members }}</td>
        <td>{{ team.compensation|floatformat:1 }}</td>
        {% for count in team.solved_by_category %}
        <td>{{ count }}</td>
        {% endfor %}
        <td>{{ team.problem_points|floatformat:1 }}</td>
        <td>{{ team.total_points|floatformat:1 }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<script>
  var countdownTime = new Date('{{ event.end_time.isoformat }}').getTime();  // this has to be a part of the html template to use context
  setCountdown();
</script>

{% if is_public %}
<script>
  autoScroll();
</script>
{% endif %}

{% endblock %}